<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Datenaufbereitung mit `dplyr` | Einführung in R</title>
  <meta name="description" content="Dies ist eine Einführung in R, die in verschiedenen Lehrveranstaltungen der Arbeitseinheiten Analyse und Modellierung komplexer Daten und Methodenlehre und Statistik des Psychologischen Instituts der Johannes Gutenberg-Universität Mainz genutzt werden." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Datenaufbereitung mit `dplyr` | Einführung in R" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://amd-lab.github.io/R-Kurs-Unterlagen/index.html" />
  
  <meta property="og:description" content="Dies ist eine Einführung in R, die in verschiedenen Lehrveranstaltungen der Arbeitseinheiten Analyse und Modellierung komplexer Daten und Methodenlehre und Statistik des Psychologischen Instituts der Johannes Gutenberg-Universität Mainz genutzt werden." />
  <meta name="github-repo" content="AMD-Lab/R-Kurs-Unterlagen" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Datenaufbereitung mit `dplyr` | Einführung in R" />
  
  <meta name="twitter:description" content="Dies ist eine Einführung in R, die in verschiedenen Lehrveranstaltungen der Arbeitseinheiten Analyse und Modellierung komplexer Daten und Methodenlehre und Statistik des Psychologischen Instituts der Johannes Gutenberg-Universität Mainz genutzt werden." />
  



<meta name="date" content="2021-12-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="datenstruktur.html"/>
<link rel="next" href="deskriptive-statistik.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Einführung in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Über dieses Skript</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#feedback"><i class="fa fa-check"></i><b>1.1</b> Feedback</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="einführung.html"><a href="einführung.html"><i class="fa fa-check"></i><b>2</b> Einführung</a><ul>
<li class="chapter" data-level="2.1" data-path="einführung.html"><a href="einführung.html#installation"><i class="fa fa-check"></i><b>2.1</b> Installation</a></li>
<li class="chapter" data-level="2.2" data-path="einführung.html"><a href="einführung.html#erste-schritte"><i class="fa fa-check"></i><b>2.2</b> Erste Schritte</a></li>
<li class="chapter" data-level="2.3" data-path="einführung.html"><a href="einführung.html#das-r-skript"><i class="fa fa-check"></i><b>2.3</b> Das R-Skript</a></li>
<li class="chapter" data-level="2.4" data-path="einführung.html"><a href="einführung.html#struktur-des-skripts"><i class="fa fa-check"></i><b>2.4</b> Struktur des Skripts</a></li>
<li class="chapter" data-level="2.5" data-path="einführung.html"><a href="einführung.html#pakete"><i class="fa fa-check"></i><b>2.5</b> Pakete</a></li>
<li class="chapter" data-level="2.6" data-path="einführung.html"><a href="einführung.html#working-directory"><i class="fa fa-check"></i><b>2.6</b> Working Directory</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="erste-schritte-1.html"><a href="erste-schritte-1.html"><i class="fa fa-check"></i><b>3</b> Erste Schritte</a><ul>
<li class="chapter" data-level="3.1" data-path="erste-schritte-1.html"><a href="erste-schritte-1.html#variablen"><i class="fa fa-check"></i><b>3.1</b> Variablen</a></li>
<li class="chapter" data-level="3.2" data-path="erste-schritte-1.html"><a href="erste-schritte-1.html#vektoren"><i class="fa fa-check"></i><b>3.2</b> Vektoren</a><ul>
<li class="chapter" data-level="3.2.1" data-path="erste-schritte-1.html"><a href="erste-schritte-1.html#datentyp-numeric"><i class="fa fa-check"></i><b>3.2.1</b> Datentyp numeric</a></li>
<li class="chapter" data-level="3.2.2" data-path="erste-schritte-1.html"><a href="erste-schritte-1.html#datentyp-character"><i class="fa fa-check"></i><b>3.2.2</b> Datentyp character</a></li>
<li class="chapter" data-level="3.2.3" data-path="erste-schritte-1.html"><a href="erste-schritte-1.html#datentyp-logical"><i class="fa fa-check"></i><b>3.2.3</b> Datentyp logical</a></li>
<li class="chapter" data-level="3.2.4" data-path="erste-schritte-1.html"><a href="erste-schritte-1.html#datentyp-factor"><i class="fa fa-check"></i><b>3.2.4</b> Datentyp factor</a></li>
<li class="chapter" data-level="3.2.5" data-path="erste-schritte-1.html"><a href="erste-schritte-1.html#datentyp-na"><i class="fa fa-check"></i><b>3.2.5</b> Datentyp NA</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="erste-schritte-1.html"><a href="erste-schritte-1.html#auswahl-von-vektorelementen"><i class="fa fa-check"></i><b>3.3</b> Auswahl von Vektorelementen</a></li>
<li class="chapter" data-level="3.4" data-path="erste-schritte-1.html"><a href="erste-schritte-1.html#logische-vergleiche"><i class="fa fa-check"></i><b>3.4</b> Logische Vergleiche</a><ul>
<li class="chapter" data-level="3.4.1" data-path="erste-schritte-1.html"><a href="erste-schritte-1.html#datentyp-numeric-1"><i class="fa fa-check"></i><b>3.4.1</b> Datentyp numeric</a></li>
<li class="chapter" data-level="3.4.2" data-path="erste-schritte-1.html"><a href="erste-schritte-1.html#datentyp-character-1"><i class="fa fa-check"></i><b>3.4.2</b> Datentyp character</a></li>
<li class="chapter" data-level="3.4.3" data-path="erste-schritte-1.html"><a href="erste-schritte-1.html#datentyp-factor-1"><i class="fa fa-check"></i><b>3.4.3</b> Datentyp factor</a></li>
<li class="chapter" data-level="3.4.4" data-path="erste-schritte-1.html"><a href="erste-schritte-1.html#rekodieren-von-variablen-mit-hilfe-logischer-vergleich"><i class="fa fa-check"></i><b>3.4.4</b> Rekodieren von Variablen mit Hilfe logischer Vergleich</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="datenstruktur.html"><a href="datenstruktur.html"><i class="fa fa-check"></i><b>4</b> Datenstruktur</a><ul>
<li class="chapter" data-level="4.1" data-path="datenstruktur.html"><a href="datenstruktur.html#rmarkdown"><i class="fa fa-check"></i><b>4.1</b> RMarkdown</a></li>
<li class="chapter" data-level="4.2" data-path="datenstruktur.html"><a href="datenstruktur.html#hilfe"><i class="fa fa-check"></i><b>4.2</b> Hilfe</a></li>
<li class="chapter" data-level="4.3" data-path="datenstruktur.html"><a href="datenstruktur.html#wiederholung-werte-vektoren"><i class="fa fa-check"></i><b>4.3</b> Wiederholung: Werte &amp; Vektoren</a><ul>
<li class="chapter" data-level="4.3.1" data-path="datenstruktur.html"><a href="datenstruktur.html#coercion-umwandlung-von-typen"><i class="fa fa-check"></i><b>4.3.1</b> Coercion (Umwandlung von Typen)</a></li>
<li class="chapter" data-level="4.3.2" data-path="datenstruktur.html"><a href="datenstruktur.html#aufruf-per-index-von-daten-aus-mehreren-ebenen"><i class="fa fa-check"></i><b>4.3.2</b> Aufruf per Index von Daten aus mehreren Ebenen</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="datenstruktur.html"><a href="datenstruktur.html#der-workspace"><i class="fa fa-check"></i><b>4.4</b> Der Workspace</a></li>
<li class="chapter" data-level="4.5" data-path="datenstruktur.html"><a href="datenstruktur.html#wiederholung-einfache-berechnungen"><i class="fa fa-check"></i><b>4.5</b> Wiederholung: Einfache Berechnungen</a><ul>
<li class="chapter" data-level="4.5.1" data-path="datenstruktur.html"><a href="datenstruktur.html#übersicht-berechnungsfunktionen"><i class="fa fa-check"></i><b>4.5.1</b> Übersicht Berechnungsfunktionen</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="datenstruktur.html"><a href="datenstruktur.html#matrizen"><i class="fa fa-check"></i><b>4.6</b> Matrizen</a></li>
<li class="chapter" data-level="4.7" data-path="datenstruktur.html"><a href="datenstruktur.html#tidy-daten"><i class="fa fa-check"></i><b>4.7</b> tidy Daten</a><ul>
<li class="chapter" data-level="4.7.1" data-path="datenstruktur.html"><a href="datenstruktur.html#tidyverse"><i class="fa fa-check"></i><b>4.7.1</b> tidyverse</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="datenstruktur.html"><a href="datenstruktur.html#data.frames-df-und-tibbles-tib"><i class="fa fa-check"></i><b>4.8</b> data.frames (df) und tibbles (tib)</a></li>
<li class="chapter" data-level="4.9" data-path="datenstruktur.html"><a href="datenstruktur.html#einlesen-und-speichern-von-daten"><i class="fa fa-check"></i><b>4.9</b> Einlesen und Speichern von Daten</a></li>
<li class="chapter" data-level="4.10" data-path="datenstruktur.html"><a href="datenstruktur.html#datensätze-dat-anschauen"><i class="fa fa-check"></i><b>4.10</b> Datensätze (dat) anschauen</a><ul>
<li class="chapter" data-level="4.10.1" data-path="datenstruktur.html"><a href="datenstruktur.html#häufigkeit-von-factorlevels"><i class="fa fa-check"></i><b>4.10.1</b> Häufigkeit von Factorlevels</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="datenaufbereitung-mit-dplyr.html"><a href="datenaufbereitung-mit-dplyr.html"><i class="fa fa-check"></i><b>5</b> Datenaufbereitung mit `dplyr`</a><ul>
<li class="chapter" data-level="5.1" data-path="datenaufbereitung-mit-dplyr.html"><a href="datenaufbereitung-mit-dplyr.html#einführung-1"><i class="fa fa-check"></i><b>5.1</b> Einführung</a></li>
<li class="chapter" data-level="5.2" data-path="datenaufbereitung-mit-dplyr.html"><a href="datenaufbereitung-mit-dplyr.html#dplyr-die-wichtigsten-befehle"><i class="fa fa-check"></i><b>5.2</b> `<code>dplyr</code>`: Die wichtigsten Befehle</a></li>
<li class="chapter" data-level="5.3" data-path="datenaufbereitung-mit-dplyr.html"><a href="datenaufbereitung-mit-dplyr.html#beispiel-filtern-von-beobachtungen-mit-filter"><i class="fa fa-check"></i><b>5.3</b> Beispiel: Filtern von Beobachtungen mit <code>filter()</code></a><ul>
<li class="chapter" data-level="5.3.1" data-path="datenaufbereitung-mit-dplyr.html"><a href="datenaufbereitung-mit-dplyr.html#filtern-von-strings-factors"><i class="fa fa-check"></i><b>5.3.1</b> Filtern von Strings / Factors</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="datenaufbereitung-mit-dplyr.html"><a href="datenaufbereitung-mit-dplyr.html#dplyr-der-piping-operator"><i class="fa fa-check"></i><b>5.4</b> Dplyr: Der Piping Operator `%&gt;%`</a></li>
<li class="chapter" data-level="5.5" data-path="datenaufbereitung-mit-dplyr.html"><a href="datenaufbereitung-mit-dplyr.html#beispiel"><i class="fa fa-check"></i><b>5.5</b> Beispiel</a></li>
<li class="chapter" data-level="5.6" data-path="datenaufbereitung-mit-dplyr.html"><a href="datenaufbereitung-mit-dplyr.html#dplyr-neue-variablen-mit-mutate-berechnen"><i class="fa fa-check"></i><b>5.6</b> Dplyr : Neue Variablen mit <code>mutate()</code> berechnen</a></li>
<li class="chapter" data-level="5.7" data-path="datenaufbereitung-mit-dplyr.html"><a href="datenaufbereitung-mit-dplyr.html#beispiel-1"><i class="fa fa-check"></i><b>5.7</b> Beispiel</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="deskriptive-statistik.html"><a href="deskriptive-statistik.html"><i class="fa fa-check"></i><b>6</b> Deskriptive Statistik</a><ul>
<li class="chapter" data-level="6.1" data-path="deskriptive-statistik.html"><a href="deskriptive-statistik.html#allgemeine-informationen-eines-datensatzes"><i class="fa fa-check"></i><b>6.1</b> Allgemeine Informationen eines Datensatzes</a></li>
<li class="chapter" data-level="6.2" data-path="deskriptive-statistik.html"><a href="deskriptive-statistik.html#lagemaße"><i class="fa fa-check"></i><b>6.2</b> Lagemaße</a><ul>
<li class="chapter" data-level="6.2.1" data-path="deskriptive-statistik.html"><a href="deskriptive-statistik.html#minimum-und-maximum"><i class="fa fa-check"></i><b>6.2.1</b> Minimum und Maximum</a></li>
<li class="chapter" data-level="6.2.2" data-path="deskriptive-statistik.html"><a href="deskriptive-statistik.html#quantile-und-perzentile"><i class="fa fa-check"></i><b>6.2.2</b> Quantile und Perzentile</a></li>
<li class="chapter" data-level="6.2.3" data-path="deskriptive-statistik.html"><a href="deskriptive-statistik.html#interquantilsabstand-iqa"><i class="fa fa-check"></i><b>6.2.3</b> Interquantilsabstand (IQA)</a></li>
<li class="chapter" data-level="6.2.4" data-path="deskriptive-statistik.html"><a href="deskriptive-statistik.html#mittelwert"><i class="fa fa-check"></i><b>6.2.4</b> Mittelwert</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="deskriptive-statistik.html"><a href="deskriptive-statistik.html#streuungsmaße"><i class="fa fa-check"></i><b>6.3</b> Streuungsmaße</a><ul>
<li class="chapter" data-level="6.3.1" data-path="deskriptive-statistik.html"><a href="deskriptive-statistik.html#standardabweichung"><i class="fa fa-check"></i><b>6.3.1</b> Standardabweichung</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="graphiken-mit-ggplot2.html"><a href="graphiken-mit-ggplot2.html"><i class="fa fa-check"></i><b>7</b> Graphiken mit ggplot2</a><ul>
<li class="chapter" data-level="7.1" data-path="graphiken-mit-ggplot2.html"><a href="graphiken-mit-ggplot2.html#exkurs-warum-viridis"><i class="fa fa-check"></i><b>7.1</b> Exkurs: Warum viridis?</a></li>
<li class="chapter" data-level="7.2" data-path="graphiken-mit-ggplot2.html"><a href="graphiken-mit-ggplot2.html#ggplot2---einführung"><i class="fa fa-check"></i><b>7.2</b> <code>ggplot2</code> - Einführung</a></li>
<li class="chapter" data-level="7.3" data-path="graphiken-mit-ggplot2.html"><a href="graphiken-mit-ggplot2.html#vor-der-visualisierung-die-daten"><i class="fa fa-check"></i><b>7.3</b> Vor der Visualisierung: Die Daten</a></li>
<li class="chapter" data-level="7.4" data-path="graphiken-mit-ggplot2.html"><a href="graphiken-mit-ggplot2.html#ästhetische-mapping"><i class="fa fa-check"></i><b>7.4</b> Ästhetische Mapping</a></li>
<li class="chapter" data-level="7.5" data-path="graphiken-mit-ggplot2.html"><a href="graphiken-mit-ggplot2.html#graphischen-funktionen"><i class="fa fa-check"></i><b>7.5</b> Graphischen Funktionen</a><ul>
<li class="chapter" data-level="7.5.1" data-path="graphiken-mit-ggplot2.html"><a href="graphiken-mit-ggplot2.html#säulen--und-balkendiagramm"><i class="fa fa-check"></i><b>7.5.1</b> Säulen- und Balkendiagramm</a></li>
<li class="chapter" data-level="7.5.2" data-path="graphiken-mit-ggplot2.html"><a href="graphiken-mit-ggplot2.html#histogramm"><i class="fa fa-check"></i><b>7.5.2</b> Histogramm</a></li>
<li class="chapter" data-level="7.5.3" data-path="graphiken-mit-ggplot2.html"><a href="graphiken-mit-ggplot2.html#qq-plot"><i class="fa fa-check"></i><b>7.5.3</b> QQ-Plot</a></li>
<li class="chapter" data-level="7.5.4" data-path="graphiken-mit-ggplot2.html"><a href="graphiken-mit-ggplot2.html#boxplot"><i class="fa fa-check"></i><b>7.5.4</b> Boxplot</a></li>
<li class="chapter" data-level="7.5.5" data-path="graphiken-mit-ggplot2.html"><a href="graphiken-mit-ggplot2.html#violinen-plot"><i class="fa fa-check"></i><b>7.5.5</b> Violinen-Plot</a></li>
<li class="chapter" data-level="7.5.6" data-path="graphiken-mit-ggplot2.html"><a href="graphiken-mit-ggplot2.html#beeswarm-plot-mit-dem-paket-ggbeeswarm"><i class="fa fa-check"></i><b>7.5.6</b> Beeswarm Plot mit dem Paket <code>ggbeeswarm</code></a></li>
<li class="chapter" data-level="7.5.7" data-path="graphiken-mit-ggplot2.html"><a href="graphiken-mit-ggplot2.html#scatterplot"><i class="fa fa-check"></i><b>7.5.7</b> Scatterplot</a></li>
<li class="chapter" data-level="7.5.8" data-path="graphiken-mit-ggplot2.html"><a href="graphiken-mit-ggplot2.html#linearer-fit"><i class="fa fa-check"></i><b>7.5.8</b> (Linearer) Fit</a></li>
<li class="chapter" data-level="7.5.9" data-path="graphiken-mit-ggplot2.html"><a href="graphiken-mit-ggplot2.html#linienplot"><i class="fa fa-check"></i><b>7.5.9</b> Linienplot</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="graphiken-mit-ggplot2.html"><a href="graphiken-mit-ggplot2.html#sonstige-funktionalität"><i class="fa fa-check"></i><b>7.6</b> Sonstige Funktionalität</a><ul>
<li class="chapter" data-level="7.6.1" data-path="graphiken-mit-ggplot2.html"><a href="graphiken-mit-ggplot2.html#labels"><i class="fa fa-check"></i><b>7.6.1</b> Labels</a></li>
<li class="chapter" data-level="7.6.2" data-path="graphiken-mit-ggplot2.html"><a href="graphiken-mit-ggplot2.html#thema"><i class="fa fa-check"></i><b>7.6.2</b> Thema</a></li>
<li class="chapter" data-level="7.6.3" data-path="graphiken-mit-ggplot2.html"><a href="graphiken-mit-ggplot2.html#position"><i class="fa fa-check"></i><b>7.6.3</b> Position</a></li>
<li class="chapter" data-level="7.6.4" data-path="graphiken-mit-ggplot2.html"><a href="graphiken-mit-ggplot2.html#legenden"><i class="fa fa-check"></i><b>7.6.4</b> Legenden</a></li>
<li class="chapter" data-level="7.6.5" data-path="graphiken-mit-ggplot2.html"><a href="graphiken-mit-ggplot2.html#koordinatensysteme"><i class="fa fa-check"></i><b>7.6.5</b> Koordinatensysteme</a></li>
<li class="chapter" data-level="7.6.6" data-path="graphiken-mit-ggplot2.html"><a href="graphiken-mit-ggplot2.html#farbskalen"><i class="fa fa-check"></i><b>7.6.6</b> Farbskalen</a></li>
<li class="chapter" data-level="7.6.7" data-path="graphiken-mit-ggplot2.html"><a href="graphiken-mit-ggplot2.html#variablenskalen"><i class="fa fa-check"></i><b>7.6.7</b> Variablenskalen</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="graphiken-mit-ggplot2.html"><a href="graphiken-mit-ggplot2.html#facetten"><i class="fa fa-check"></i><b>7.7</b> Facetten</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/AMD-Lab/R-Kurs-Buch" target="blank">
Veröffentlicht auf GitHub, erstellt mit bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Einführung in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="datenaufbereitung-mit-dplyr" class="section level1">
<h1><span class="header-section-number">5</span> Datenaufbereitung mit `dplyr`</h1>
<p><img src="_static/dplyr_hex.png" width="232" /></p>
<p><img src="_static/data_wrangler.png" width="419" /></p>
<div id="einführung-1" class="section level2">
<h2><span class="header-section-number">5.1</span> Einführung</h2>
<p>Dplyr ist Teil des `tidyverse` Packages und ermöglicht es, Daten sehr einfach zu manipulieren und in eine Form zu bringen, um diese zu analysieren. Der größte Vorteil dabei ist die einfache Syntax des Packages. Diese ermöglicht es, komplexe Operationen und Umformungen mit relativ wenigen Codezeilen zu realisieren. Um <code>dplyr</code> kennenzulernen, werden wir mit dem <code>Starwars</code> Datensatz arbeiten. Dieser enthält verschiedenen Informationen zu unterschiedlichen Charakteren der Star Wars Saga, wie zum Beispiel das Alter, Geschlecht, Heimatplanet oder Alienrasse. Zunächst lesen wir den Datensatz mit <code>readRDS()</code> ein und verschaffen uns dann einen ersten Überblick über den Datensatz:</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="datenaufbereitung-mit-dplyr.html#cb202-1"></a><span class="co"># Der Datensatz befindet sich im Buch im Verzeichnis &quot;Data&quot;. </span></span>
<span id="cb202-2"><a href="datenaufbereitung-mit-dplyr.html#cb202-2"></a><span class="co"># Daher muss der Pfad beim einlesen des Datensatzes mit angegeben werden.</span></span>
<span id="cb202-3"><a href="datenaufbereitung-mit-dplyr.html#cb202-3"></a></span>
<span id="cb202-4"><a href="datenaufbereitung-mit-dplyr.html#cb202-4"></a>starwars &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&quot;starwars.RDS&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">drop_na</span>()</span></code></pre></div>
<p>Wir benutzen den <code>head()</code> Befehl, um uns die ersten 5 Zeilen des Datensatzes anzeigen zu lassen.</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="datenaufbereitung-mit-dplyr.html#cb203-1"></a><span class="co"># Wir lassen uns zunächst die ersten 5 Zeilen des Datensatzes ausgeben. </span></span>
<span id="cb203-2"><a href="datenaufbereitung-mit-dplyr.html#cb203-2"></a></span>
<span id="cb203-3"><a href="datenaufbereitung-mit-dplyr.html#cb203-3"></a></span>
<span id="cb203-4"><a href="datenaufbereitung-mit-dplyr.html#cb203-4"></a><span class="kw">head</span>(starwars,<span class="dv">5</span>) </span></code></pre></div>
<pre><code>## # A tibble: 5 × 11
##   name    height  mass hair_color skin_color eye_color   Age
##   &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;fct&gt;      &lt;fct&gt;      &lt;fct&gt;     &lt;dbl&gt;
## 1 Luke S…    172    77 blond      fair       blue       19  
## 2 Darth …    202   136 none       white      yellow     41.9
## 3 Leia O…    150    49 brown      light      brown      19  
## 4 Owen L…    178   120 brown, gr… light      blue       52  
## 5 Beru W…    165    75 brown      light      blue       47  
## # … with 4 more variables: sex &lt;fct&gt;, gender &lt;fct&gt;,
## #   homeworld &lt;chr&gt;, species &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="datenaufbereitung-mit-dplyr.html#cb205-1"></a><span class="co"># Analog können wir auch mit den Befehl `tail()`, die letzten n Zeilen eines Datensatzes anzeigen.</span></span>
<span id="cb205-2"><a href="datenaufbereitung-mit-dplyr.html#cb205-2"></a></span>
<span id="cb205-3"><a href="datenaufbereitung-mit-dplyr.html#cb205-3"></a></span>
<span id="cb205-4"><a href="datenaufbereitung-mit-dplyr.html#cb205-4"></a><span class="kw">tail</span>(starwars,<span class="dv">5</span>)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 11
##   name    height  mass hair_color skin_color eye_color   Age
##   &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;fct&gt;      &lt;fct&gt;      &lt;fct&gt;     &lt;dbl&gt;
## 1 Lumina…    170  56.2 black      yellow     blue         58
## 2 Barris…    166  50   black      yellow     blue         40
## 3 Dooku      193  80   white      fair       brown       102
## 4 Jango …    183  79   black      tan        brown        66
## 5 Padmé …    165  45   brown      light      brown        46
## # … with 4 more variables: sex &lt;fct&gt;, gender &lt;fct&gt;,
## #   homeworld &lt;chr&gt;, species &lt;chr&gt;</code></pre>
<p>Nachdem wir nun eine erste “Augapfeldiagnostik” des Datensatzes betrieben haben, sollten wir uns nun die einzelnen Variablen genauer ansehen. Um einen ersten Überblick in die unterschiedlichen Parameter der Variablen zu bekommen, eignet sich der <code>summary()</code> Befehl. Dieser berechnet die wichtigstens Kennwerte der im Datensatz enthaltenen Variablen wie Mittelwert, Median, Quantile, Minimum, Maximum und fehlende Werte.</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="datenaufbereitung-mit-dplyr.html#cb207-1"></a><span class="kw">summary</span>(starwars)</span></code></pre></div>
<pre><code>##      name               height         mass       
##  Length:29          Min.   : 88   Min.   : 20.00  
##  Class :character   1st Qu.:170   1st Qu.: 75.00  
##  Mode  :character   Median :180   Median : 79.00  
##                     Mean   :178   Mean   : 77.77  
##                     3rd Qu.:188   3rd Qu.: 83.00  
##                     Max.   :228   Max.   :136.00  
##                                                   
##          hair_color   skin_color   eye_color 
##  none         :9    fair   :7    brown  :10  
##  brown        :7    light  :6    blue   : 8  
##  black        :6    dark   :2    yellow : 4  
##  blond        :2    orange :2    hazel  : 2  
##  white        :2    pale   :2    orange : 2  
##  auburn, white:1    yellow :2    black  : 1  
##  (Other)      :2    (Other):8    (Other): 2  
##       Age                     sex           gender  
##  Min.   :  8.00   female        : 6   feminine : 6  
##  1st Qu.: 31.00   hermaphroditic: 0   masculine:23  
##  Median : 46.00   male          :23                 
##  Mean   : 51.29   none          : 0                 
##  3rd Qu.: 57.00                                     
##  Max.   :200.00                                     
##                                                     
##   homeworld           species         
##  Length:29          Length:29         
##  Class :character   Class :character  
##  Mode  :character   Mode  :character  
##                                       
##                                       
##                                       
## </code></pre>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="datenaufbereitung-mit-dplyr.html#cb209-1"></a><span class="co"># Wir sehen nun die Unterschiedlichen Verteilungsinformationen jeder Variablen. Für factors bzw. character Variablen, werden hier die Häufigkeiten der einzelnen Kategorien angezeigt. </span></span></code></pre></div>
</div>
<div id="dplyr-die-wichtigsten-befehle" class="section level2">
<h2><span class="header-section-number">5.2</span> `<code>dplyr</code>`: Die wichtigsten Befehle</h2>
<p>Wie am Anfang des Kapitels bereits erwähnt, ermöglicht es <code>dplyr</code> mit relativ einfachen Mitteln, komplexe Operationen und Transformationen in Datensätzen vorzunehmen. Hierzu hat <code>dplyr</code> eine eigene Syntax entwickelt, die sich sehr stark von der ursprünglichen R-Syntax unterscheidet. Diese baut auf wenigen, relativ intuitiven Befehlen auf, welche verkettet werden können. Zunächst eine Übersicht der wichtigsten Befehle:</p>
<ul>
<li><p><code>filter()</code> - Filtern von Beobachtungen nach einem bestimmten Kriterium</p></li>
<li><p><code>arrange()</code>- Reihen neu Sortieren</p></li>
<li><p><code>select()</code> - Auswahl von Variablen nach deren Name</p></li>
<li><p><code>mutate()</code> - Erstellen von neuen Variablen aus bereits existierenden</p></li>
<li><p><code>summarise()</code> - Viele Werte zu einem einzelnen Wert zusammenfassen</p></li>
<li><p><code>group_by()</code> - Gruppieren von Daten nach bestimmten Variablen in Kombination mit anderen Funktionen</p></li>
</ul>
<p>Der vielleicht wichtigste Befehl ist der <code>group_by()</code> Befehl, mit dem die oben genannten Befehle auf einzelne Gruppen innerhalb eines Datensatzes anwendbar sind.</p>
<p>Diese sechs sogennaten "<strong><em>Verben"</em></strong> bilden die Grundlage von <code>dplyr</code>. Mit ihnen ist es möglich mehrere einfache Schritte miteinander zu verketten, um ein komplexes Ergebnis zu erzielen. Alles Befehle funktionieren auf die gleiche Art und Weise. Jede Operation ist durch die gleiche Struktur gekennzeichnet:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Das erste Argument ist ein Dataframe.</strong></p></li>
<li><p><strong>Die nachfolgenden Argumente beschreiben, was mit dem Dataframe geschehen soll, wobei die Variablennamen (ohne Anführungszeichen) verwendet werden.</strong></p></li>
<li><p><strong>Das Ergebnis ist ein neuer Dataframe</strong></p></li>
</ol>
</div>
<div id="beispiel-filtern-von-beobachtungen-mit-filter" class="section level2">
<h2><span class="header-section-number">5.3</span> Beispiel: Filtern von Beobachtungen mit <code>filter()</code></h2>
<p>Um effektiv nach bestimmten Werten zu filtern, müssen für jede Operation die Kriterien nach denen gefiltetert werden soll definiert werden. Dies geschiet mit Hilfe der bereits eingeführten logischen Operatoren. Im ersten Beispiel sollen alle Beobachtungen, in welchen die Variablen <code>height</code> und <code>mass</code> größer als <code>190</code> bzw. <code>90</code> sind gefiltert werden:</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="datenaufbereitung-mit-dplyr.html#cb210-1"></a><span class="co"># Es werden hier nun alle Helden aus dem Datensatz ausgegeben, die größer als 1,90 m und schwerer als 90 Kilogramm sind</span></span>
<span id="cb210-2"><a href="datenaufbereitung-mit-dplyr.html#cb210-2"></a></span>
<span id="cb210-3"><a href="datenaufbereitung-mit-dplyr.html#cb210-3"></a><span class="kw">filter</span>(starwars, height <span class="op">&gt;</span><span class="st"> </span><span class="dv">190</span> <span class="op">&amp;</span><span class="st"> </span>mass <span class="op">&gt;</span><span class="st"> </span><span class="dv">90</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 11
##   name    height  mass hair_color skin_color eye_color   Age
##   &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;fct&gt;      &lt;fct&gt;      &lt;fct&gt;     &lt;dbl&gt;
## 1 Darth …    202   136 none       white      yellow     41.9
## 2 Chewba…    228   112 brown      unknown    blue      200  
## # … with 4 more variables: sex &lt;fct&gt;, gender &lt;fct&gt;,
## #   homeworld &lt;chr&gt;, species &lt;chr&gt;</code></pre>
<div id="filtern-von-strings-factors" class="section level3">
<h3><span class="header-section-number">5.3.1</span> Filtern von Strings / Factors</h3>
<p>Logische Operatoren lassen sich sehr gut auf numerische / bzw. kontinuierliche Variablen anwenden, um diese nach bestimmten Kriterien zu filtern. Wenn mit Strings oder Factors gearbeitet wird, sucht man häufig nach bestimmen <code>pattern</code> in den Strings, wie hier bei den Namen.</p>
<p><img src="_static/dplyr_filter_sm.png" /></p>
<p>Sollen nun alle Beobachtungen mit “Skywalker” im Namen gefiltert werden, kann die <code>grepl()</code> Funktion aus R genutzt werden. Diese prüft, ob eine Zeichenfolge vorhanden ist oder nicht und gibt dann entsprechend <code>TRUE</code> oder <code>FALSE</code> aus, was ein filtern ermöglicht. Dies ist vorallem bei Strings, die aus mehr als einem Wort bestehen, dass durch ein Leerzeichen getrennt ist sehr praktisch. Bei Strings die nur aus einem Wort bestehen oder Factors, kann auch mit einem einfach <code>==</code> Vergleich gearbeitet werden: Beispiel:</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="datenaufbereitung-mit-dplyr.html#cb212-1"></a><span class="co"># Hier werden alle Beobachtungen mit der Spezies &quot;Human&quot; gefiltert. </span></span>
<span id="cb212-2"><a href="datenaufbereitung-mit-dplyr.html#cb212-2"></a></span>
<span id="cb212-3"><a href="datenaufbereitung-mit-dplyr.html#cb212-3"></a><span class="kw">filter</span>(starwars, species <span class="op">==</span><span class="st"> &quot;Human&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 18 × 11
##    name   height  mass hair_color skin_color eye_color   Age
##    &lt;chr&gt;   &lt;int&gt; &lt;dbl&gt; &lt;fct&gt;      &lt;fct&gt;      &lt;fct&gt;     &lt;dbl&gt;
##  1 Luke …    172  77   blond      fair       blue       19  
##  2 Darth…    202 136   none       white      yellow     41.9
##  3 Leia …    150  49   brown      light      brown      19  
##  4 Owen …    178 120   brown, gr… light      blue       52  
##  5 Beru …    165  75   brown      light      blue       47  
##  6 Biggs…    183  84   black      light      brown      24  
##  7 Obi-W…    182  77   auburn, w… fair       blue-gray  57  
##  8 Anaki…    188  84   blond      fair       blue       41.9
##  9 Han S…    180  80   brown      fair       brown      29  
## 10 Wedge…    170  77   brown      fair       hazel      21  
## 11 Palpa…    170  75   grey       pale       yellow     82  
## 12 Boba …    183  78.2 black      fair       brown      31.5
## 13 Lando…    177  79   black      dark       brown      31  
## 14 Lobot     175  79   none       light      blue       37  
## 15 Mace …    188  84   none       dark       brown      72  
## 16 Dooku     193  80   white      fair       brown     102  
## 17 Jango…    183  79   black      tan        brown      66  
## 18 Padmé…    165  45   brown      light      brown      46  
## # … with 4 more variables: sex &lt;fct&gt;, gender &lt;fct&gt;,
## #   homeworld &lt;chr&gt;, species &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="datenaufbereitung-mit-dplyr.html#cb214-1"></a><span class="co"># Analog hierzu kann genau so auch nach bestimmten Faktorstufen gefiltert werden:</span></span>
<span id="cb214-2"><a href="datenaufbereitung-mit-dplyr.html#cb214-2"></a></span>
<span id="cb214-3"><a href="datenaufbereitung-mit-dplyr.html#cb214-3"></a><span class="kw">filter</span>(starwars, sex <span class="op">==</span><span class="st"> &quot;male&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 23 × 11
##    name   height  mass hair_color skin_color eye_color   Age
##    &lt;chr&gt;   &lt;int&gt; &lt;dbl&gt; &lt;fct&gt;      &lt;fct&gt;      &lt;fct&gt;     &lt;dbl&gt;
##  1 Luke …    172    77 blond      fair       blue       19  
##  2 Darth…    202   136 none       white      yellow     41.9
##  3 Owen …    178   120 brown, gr… light      blue       52  
##  4 Biggs…    183    84 black      light      brown      24  
##  5 Obi-W…    182    77 auburn, w… fair       blue-gray  57  
##  6 Anaki…    188    84 blond      fair       blue       41.9
##  7 Chewb…    228   112 brown      unknown    blue      200  
##  8 Han S…    180    80 brown      fair       brown      29  
##  9 Wedge…    170    77 brown      fair       hazel      21  
## 10 Palpa…    170    75 grey       pale       yellow     82  
## # … with 13 more rows, and 4 more variables: sex &lt;fct&gt;,
## #   gender &lt;fct&gt;, homeworld &lt;chr&gt;, species &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="datenaufbereitung-mit-dplyr.html#cb216-1"></a><span class="co"># Um komplexere Strings zu filtern, kann die grepl() funktion integriert werden. Hier werden alle Beocbachtungen gefiltert, welche innerhalb der Variable &quot;name&quot; den String &quot;Skywalker&quot; enthalten. So erhalten wir alle Skywalker Charaktere, die im Datensatz vorhanden sind:</span></span>
<span id="cb216-2"><a href="datenaufbereitung-mit-dplyr.html#cb216-2"></a></span>
<span id="cb216-3"><a href="datenaufbereitung-mit-dplyr.html#cb216-3"></a><span class="kw">filter</span>(starwars, <span class="kw">grepl</span>(<span class="st">&quot;Skywalker&quot;</span>, name))</span></code></pre></div>
<pre><code>## # A tibble: 2 × 11
##   name    height  mass hair_color skin_color eye_color   Age
##   &lt;chr&gt;    &lt;int&gt; &lt;dbl&gt; &lt;fct&gt;      &lt;fct&gt;      &lt;fct&gt;     &lt;dbl&gt;
## 1 Luke S…    172    77 blond      fair       blue       19  
## 2 Anakin…    188    84 blond      fair       blue       41.9
## # … with 4 more variables: sex &lt;fct&gt;, gender &lt;fct&gt;,
## #   homeworld &lt;chr&gt;, species &lt;chr&gt;</code></pre>
</div>
</div>
<div id="dplyr-der-piping-operator" class="section level2">
<h2><span class="header-section-number">5.4</span> Dplyr: Der Piping Operator `%&gt;%`</h2>
<p>Die vielleicht wichtigste Funktion in <code>dplyr</code> ist der sogenannte “piping operator” <code>%&gt;%</code>. Mit diesem können beliebig viele Befehle kombiniert, oder auch “verkettet” werden, um einen Datensatz umzuformen. Hierbei bleiben die oben vorgestellten Prinzipien gültig:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Das erste Argument ist ein Dataframe.</strong></p></li>
<li><p><strong>Die nachfolgenden Argumente beschreiben, was mit dem Dataframe geschehen soll, wobei die Variablennamen (ohne Anführungszeichen) verwendet werden.</strong></p></li>
<li><p><strong>Das Ergebnis ist ein neuer Dataframe</strong></p></li>
</ol>
<p>In diesem Kapitel werden nur die basis dplyr-Funktionen besprochen und wie diese in einer Pipline integriert werden können. Prinzipiell lassen sich jedoch auch alle anderen R-Befehle in eine “Pipeline” integrieren, wie zum Beispiel statistische Transformationen. Es spielt keine Rolle, welche Befehle innerhalb einer Pipeline ausgeführt werden, solange die oben genannten Prinzipien eingehalten werden.</p>
<p>Hier ein sehr fortgeschrittenes Beispiel, wie dies aussehen kann. Es wurden in diesem Beispiel Funktionen aus unterschiedlichen Paketen verwendet (z.B. <code>fisherz()</code> aus dem <code>psych</code> Package), als auch Funktionen von R (<code>cor()</code>) um aus einem sehr großen Datensatz mit 1 Millionen Beobachtungen, mittlere Korrelationen zwischen unterschiedlichen Variablen zu berechnen:</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="datenaufbereitung-mit-dplyr.html#cb218-1"></a><span class="co"># df_clean %&gt;% group_by(N,K,Retrievals) %&gt;%  </span></span>
<span id="cb218-2"><a href="datenaufbereitung-mit-dplyr.html#cb218-2"></a><span class="co">#   summarise(corA = cor(mu_est_a, mu_real_a),</span></span>
<span id="cb218-3"><a href="datenaufbereitung-mit-dplyr.html#cb218-3"></a><span class="co">#             corC = cor(mu_est_c, mu_real_c)) %&gt;%</span></span>
<span id="cb218-4"><a href="datenaufbereitung-mit-dplyr.html#cb218-4"></a><span class="co">#   mutate(z_a = fisherz(corA), z_c = fisherz(corC)) %&gt;% </span></span>
<span id="cb218-5"><a href="datenaufbereitung-mit-dplyr.html#cb218-5"></a><span class="co">#   filter(Retrievals== 100) %&gt;%</span></span>
<span id="cb218-6"><a href="datenaufbereitung-mit-dplyr.html#cb218-6"></a><span class="co">#   group_by(N,K) %&gt;%  </span></span>
<span id="cb218-7"><a href="datenaufbereitung-mit-dplyr.html#cb218-7"></a><span class="co">#   summarise(mean_a_100 = mean(z_a),</span></span>
<span id="cb218-8"><a href="datenaufbereitung-mit-dplyr.html#cb218-8"></a><span class="co">#             mean_c_100 = mean(z_c),</span></span>
<span id="cb218-9"><a href="datenaufbereitung-mit-dplyr.html#cb218-9"></a><span class="co">#             range_cor = range(mean_a_100),</span></span>
<span id="cb218-10"><a href="datenaufbereitung-mit-dplyr.html#cb218-10"></a><span class="co">#             range_cor = range(mean_a_100)) %&gt;%</span></span>
<span id="cb218-11"><a href="datenaufbereitung-mit-dplyr.html#cb218-11"></a><span class="co">#   mutate(meanCorA_100 = fisherz2r(mean_a_100),</span></span>
<span id="cb218-12"><a href="datenaufbereitung-mit-dplyr.html#cb218-12"></a><span class="co">#          meanCorC_100 = fisherz2r(mean_c_100)) %&gt;%</span></span>
<span id="cb218-13"><a href="datenaufbereitung-mit-dplyr.html#cb218-13"></a><span class="co">#   select(-c(mean_a_100, mean_c_100))</span></span></code></pre></div>
</div>
<div id="beispiel" class="section level2">
<h2><span class="header-section-number">5.5</span> Beispiel</h2>
<p>Um nun verschiedene Operationen zu einer Pipeline zu verketten, können wir zwischen die einzelnen <code>dplyr</code> Befehle den Pining Operator <code>%&gt;%</code> schalten.</p>
<p>Soll zum Beispiel der Mittelwert des Alters der Helden aus dem Starwars Datensatz für verschiedene Gruppen (hier Heimatwelten und Spezies) berechnet werden, können hierfür der <code>group_by()</code> und der <code>summarise()</code> Befehl kombiniert werden. Zunächst Gruppieren wir den Datensatz nach den Variablen <code>species</code> und <code>homeworld</code> und berechnen dann mit <code>summarise()</code> eine neue Variable <code>mean_Age</code> für jede Gruppenkombination. Hierbei wird innerhalb von <code>summarise()</code> der Mittelwert der <code>Age</code> Variablen berechnet und in der neuen Variablen <code>mean_Age</code> gespeichert. Hierbei gelten die oben genannten Prinzipien, welche dann mit <code>%&gt;%</code> verkettet werden:</p>
<ol style="list-style-type: decimal">
<li><p>Das erste Argument ist ein Dataframe: <code>starwars</code></p></li>
<li><p>Die nachfolgenden Argumente beschreiben, was mit dem Dataframe geschehen soll:</p>
<p><code>group_by(species, homeworld)</code> und <code>summarise(mean_Age=mean(Age))</code></p></li>
<li><p>Das Ergebnis ist ein neuer Dataframe, der nur noch die Gruppenvariablen <code>Homeworld</code> und <code>Species</code>, sowie die neu berechnete Variable <code>mean_Ages</code> enthält:</p></li>
</ol>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="datenaufbereitung-mit-dplyr.html#cb219-1"></a><span class="co"># Dazu benutzen wir den Piping Operator %&gt;%, um die Befehle zu verketten:</span></span>
<span id="cb219-2"><a href="datenaufbereitung-mit-dplyr.html#cb219-2"></a></span>
<span id="cb219-3"><a href="datenaufbereitung-mit-dplyr.html#cb219-3"></a>starwars <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb219-4"><a href="datenaufbereitung-mit-dplyr.html#cb219-4"></a><span class="st">  </span><span class="kw">group_by</span>(species, homeworld) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb219-5"><a href="datenaufbereitung-mit-dplyr.html#cb219-5"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_Age=</span><span class="kw">mean</span>(Age))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;species&#39;. You can override using the `.groups` argument.</code></pre>
<pre><code>## # A tibble: 21 × 3
## # Groups:   species [11]
##    species homeworld    mean_Age
##    &lt;chr&gt;   &lt;chr&gt;           &lt;dbl&gt;
##  1 Cerean  Cerea            92  
##  2 Ewok    Endor             8  
##  3 Gungan  Naboo            52  
##  4 Human   Alderaan         19  
##  5 Human   Bespin           37  
##  6 Human   Concord Dawn     66  
##  7 Human   Corellia         25  
##  8 Human   Haruun Kal       72  
##  9 Human   Kamino           31.5
## 10 Human   Naboo            64  
## # … with 11 more rows</code></pre>
<p>Natürlichsprachlich dargestellt werden also folgende Operationen ausgeführt:</p>
<ol style="list-style-type: decimal">
<li>Nehme den Datensatz `starwars` (1. Zuerst der Dataframe):</li>
</ol>
<!-- -->
<pre><code>`starwars %&gt;%`</code></pre>
<ol start="2" style="list-style-type: decimal">
<li><p>Gruppiere diesen nach Spezies und Heimatwelt (1. Verarbeitungsschritt):</p>
<p><code>group_by(species, homeworld) %&gt;%</code></p></li>
<li><p>Berechne dann für jede dieser Gruppen den Mittelwert für die Variable “Age” (2. Schritt):</p></li>
</ol>
<!-- -->
<pre><code>`summarise(meanAge=mean(Age)`</code></pre>
<p>Da nun der Piping-Operator die einzelnen Elemente miteinander verkettet, ist es nicht mehr notwendig, den Datensatz innerhalb der einzelnen Befehle als Argument anzugeben, so wie im Beipsiel von <code>filter()</code>. Es muss lediglich der Ausgangsdatensatz am Anfang der Pipeline angeben werden.</p>
</div>
<div id="dplyr-neue-variablen-mit-mutate-berechnen" class="section level2">
<h2><span class="header-section-number">5.6</span> Dplyr : Neue Variablen mit <code>mutate()</code> berechnen</h2>
<p><img src="_static/dplyr_mutate.png" /></p>
<p>Der letzte wichtige Befehl in <code>dplyr</code> ist <code>mutate()</code> bzw. <code>across()</code>. Mit <code>mutate()</code> bzw. <code>across()</code> ist es möglich eine Variable bzw. mehrere Variablen umzuformen, oder neu zu berechnen. Dies wird hier anhand einer z-Tranformation erläutert. Dies ermöglicht der Befehl <code>scale()</code>, der standardmäßig in R vorhanden ist.</p>
</div>
<div id="beispiel-1" class="section level2">
<h2><span class="header-section-number">5.7</span> Beispiel</h2>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="datenaufbereitung-mit-dplyr.html#cb224-1"></a>starwars <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb224-2"><a href="datenaufbereitung-mit-dplyr.html#cb224-2"></a><span class="st">  </span><span class="kw">select</span>(height,mass) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb224-3"><a href="datenaufbereitung-mit-dplyr.html#cb224-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">z_height =</span> <span class="kw">scale</span>(height),</span>
<span id="cb224-4"><a href="datenaufbereitung-mit-dplyr.html#cb224-4"></a>         <span class="dt">z_mass =</span> <span class="kw">scale</span>(mass)) </span></code></pre></div>
<pre><code>## # A tibble: 29 × 4
##    height  mass z_height[,1] z_mass[,1]
##     &lt;int&gt; &lt;dbl&gt;        &lt;dbl&gt;      &lt;dbl&gt;
##  1    172    77     -0.265      -0.0335
##  2    202   136      1.07        2.52  
##  3    150    49     -1.24       -1.25  
##  4    178   120      0.00153     1.83  
##  5    165    75     -0.576      -0.120 
##  6    183    84      0.224       0.270 
##  7    182    77      0.179      -0.0335
##  8    188    84      0.446       0.270 
##  9    228   112      2.22        1.48  
## 10    180    80      0.0904      0.0965
## # … with 19 more rows</code></pre>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="datenaufbereitung-mit-dplyr.html#cb226-1"></a> starwars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(height,mass) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb226-2"><a href="datenaufbereitung-mit-dplyr.html#cb226-2"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">c</span>(height,mass), <span class="kw">list</span>(<span class="dt">z=</span>scale)))</span></code></pre></div>
<pre><code>## # A tibble: 29 × 4
##    height  mass height_z[,1] mass_z[,1]
##     &lt;int&gt; &lt;dbl&gt;        &lt;dbl&gt;      &lt;dbl&gt;
##  1    172    77     -0.265      -0.0335
##  2    202   136      1.07        2.52  
##  3    150    49     -1.24       -1.25  
##  4    178   120      0.00153     1.83  
##  5    165    75     -0.576      -0.120 
##  6    183    84      0.224       0.270 
##  7    182    77      0.179      -0.0335
##  8    188    84      0.446       0.270 
##  9    228   112      2.22        1.48  
## 10    180    80      0.0904      0.0965
## # … with 19 more rows</code></pre>
<p>In diesem Beispiel wurden zunächst nur <code>height</code> und <code>mass</code> mit dem <code>select()</code> Befehl ausgewählt, daher werden auch nur diese beiden Spalten am Ende der Pipline im Datensatz angezeigt. Dies kann hilfreich sein, wenn man einen Datensatz mit sehr vielen Variablen analysieren muss, von denen nur einige wenige interessant sind. Dies ist z.B. bei Fragebögen der Fall, die unterschiedliche Facetten erfassen.</p>
<p>Der nächste Befehl <code>mutate()</code> besteht immer aus einer Operation, die mit einer Spalte im Datensatz durchgeführt wird. Im Beispiel oben fügen werden die Spalten <code>z_height</code> und <code>z_mass</code> berechnet, die sich jeweils aus <code>scale(SPALTENNAME)</code> zusammensetzen und die z-Werte der jeweiligen Variablen ausgeben.</p>
<p>Anstatt beide Variablen einzeln zu transformieren, kann den Befehl <code>scale()</code> auch direkt auf mehrere Spalten angewendet werden. Dazu kann der <code>across()</code> Befehl verwendet werden.</p>
<p><img src="_static/dplyr_across_where.jpeg" /></p>
<p>Hier muss innerhalb von <code>mutate()</code> einfach mit <code>across(c(SPALTE1, SPALTE2))</code> ein Vektor der zu tranformierenden Spalten übergeben werden, sowie die Funktion(en), welche auf die Spalten angewand werden soll. Dies muss dann wie folgt definiert werden:</p>
<p><code>mutate(across(c(height,mass), list(z=scale)))</code></p>
<p>Diese Schreibweise hat den Vorteil das</p>
<ol style="list-style-type: decimal">
<li><p>In der <code>list()</code> mehrere Befehle übergeben werden können</p></li>
<li><p>Die Originalspalten beibehalten werden</p></li>
<li><p>Den neuen Spalten direkt einen Suffix zugewiesen werden kann.<br />
Dieser wird automatisch als “_suffix” an die neue Variable angehängt.</p></li>
</ol>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="datenaufbereitung-mit-dplyr.html#cb228-1"></a>starwars <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">c</span>(height,mass), <span class="kw">list</span>(<span class="dt">z=</span>scale)))</span></code></pre></div>
<pre><code>## # A tibble: 29 × 13
##    name   height  mass hair_color skin_color eye_color   Age
##    &lt;chr&gt;   &lt;int&gt; &lt;dbl&gt; &lt;fct&gt;      &lt;fct&gt;      &lt;fct&gt;     &lt;dbl&gt;
##  1 Luke …    172    77 blond      fair       blue       19  
##  2 Darth…    202   136 none       white      yellow     41.9
##  3 Leia …    150    49 brown      light      brown      19  
##  4 Owen …    178   120 brown, gr… light      blue       52  
##  5 Beru …    165    75 brown      light      blue       47  
##  6 Biggs…    183    84 black      light      brown      24  
##  7 Obi-W…    182    77 auburn, w… fair       blue-gray  57  
##  8 Anaki…    188    84 blond      fair       blue       41.9
##  9 Chewb…    228   112 brown      unknown    blue      200  
## 10 Han S…    180    80 brown      fair       brown      29  
## # … with 19 more rows, and 6 more variables: sex &lt;fct&gt;,
## #   gender &lt;fct&gt;, homeworld &lt;chr&gt;, species &lt;chr&gt;,
## #   height_z &lt;dbl[,1]&gt;, mass_z &lt;dbl[,1]&gt;</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="datenstruktur.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="deskriptive-statistik.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
